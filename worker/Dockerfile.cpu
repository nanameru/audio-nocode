FROM python:3.10-slim

# ffmpeg をインストール
RUN apt-get update && apt-get install -y ffmpeg && rm -rf /var/lib/apt/lists/*

# PyTorch と pyannote（CPU版）
RUN pip install -U pip wheel setuptools \
 && pip install torch==2.2.2 torchaudio==2.2.2 --index-url https://download.pytorch.org/whl/cpu \
 && pip install "numpy<2" pyannote.audio==3.1.1 pyannote.metrics==3.2.1 ffmpeg-python==0.2.0 google-cloud-storage

WORKDIR /app
COPY worker.py /app/worker.py

ENTRYPOINT ["python3", "/app/worker.py"]
